version: 2
references:
  workspace: ~/src
  
  android_config:
    working_directory: ~/src
    docker:
    - image: circleci/android:api-27
    environment:
      TERM: dumb
      _JAVA_OPTIONS: -Xmx2048m -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap
      GRADLE_OPTS: -Dorg.gradle.jvmargs="-Xmx2048m"
      
jobs:
  deploy_qs:
    working_directory: ~/src
    docker:
    - image: circleci/android:api-27
    environment:
    - CIRCLE_COMPARE_URL: https://github.com/YuriRudenyaDev/test_jenkins/compare/a5fbd7035e09fc0bb6868dedc8d00e00fd46fadb...8f950fa0653ac4a76532bae51998c001f0823fa1
    - TERM: dumb
    - _JAVA_OPTIONS: -Xmx2048m -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap
    - GRADLE_OPTS: -Dorg.gradle.jvmargs="-Xmx2048m"
    steps:
    - checkout
    
  merge_after_pull_request:
    working_directory: ~/src
    docker:
    - image: circleci/android:api-27
    environment:
    - CIRCLE_COMPARE_URL: https://github.com/YuriRudenyaDev/test_jenkins/compare/a5fbd7035e09fc0bb6868dedc8d00e00fd46fadb...8f950fa0653ac4a76532bae51998c001f0823fa1
    - TERM: dumb
    - _JAVA_OPTIONS: -Xmx2048m -XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap
    - GRADLE_OPTS: -Dorg.gradle.jvmargs="-Xmx2048m"
    steps:
    - checkout
    
workflows:
  version: 2
  workflow:
    jobs:
    - deploy_qs:
        requires:
        - approval_for_build_after_pull_request
#        filters:
#          branches:
#            only:
#            - /pull\/[0-9]+/
    - approval_for_build_after_pull_request:
        type: approval
#        filters:
#          branches:
#            only:
#            - /pull\/[0-9]+/
 #      - merge_after_pull_request:
#        requires:
#        - approval_for_merge_after_pull_request
#        filters:
#          branches:
#            only:
#            - /pull\/[0-9]+/
#    - approval_for_merge_after_pull_request:
#        type: approval
#        requires:
#        - deploy_qs
#        filters:
#          branches:
#            only:
#            - /pull\/[0-9]+/
